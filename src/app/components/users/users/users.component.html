<div class="p-6">
  <!-- Heading + Search -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold">Users</h2>
    <input
      type="text"
      placeholder="Search by username or email"
      [(ngModel)]="searchTerm"
      (input)="search()"
      class="border border-gray-300 rounded px-4 py-2 w-72"
    />
    <button
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 ml-4"
      (click)="openAddModal()"
    >
      + Add User
    </button>
  </div>

  <!-- Users Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white dark:bg-gray-900 shadow rounded-lg">
      <thead>
        <tr class="bg-gray-100 dark:bg-gray-800 text-left">
          <th class="py-3 px-4">#</th>
          <th class="py-3 px-4">Username</th>
          <th class="py-3 px-4">Email</th>
          <th class="py-3 px-4">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let user of filteredUsers; let i = index"
          class="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"
        >
          <td class="py-3 px-4">{{ i + 1 }}</td>
          <td class="py-3 px-4">{{ user.username }}</td>
          <td class="py-3 px-4">{{ user.email }}</td>
          <td class="py-3 px-4 space-x-2">
            <button
              class="text-blue-600 hover:underline"
              (click)="openEditModal(user)"
            >
              Edit
            </button>
            <button
              class="text-red-600 hover:underline"
              (click)="confirmDelete(user)"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Add User Modal -->
<div
  *ngIf="showAddModal"
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
>
  <div class="bg-white dark:bg-gray-900 rounded-lg w-full max-w-md p-6 relative">
    <button class="absolute top-2 right-2 text-gray-600" (click)="showAddModal = false">✖</button>
    <h3 class="text-xl font-semibold mb-4">Add New User</h3>
    <div class="space-y-4">
      <input
        type="text"
        placeholder="Username"
        [(ngModel)]="newUser.username"
        class="w-full border px-4 py-2 rounded"
      />
      <input
        type="email"
        placeholder="Email"
        [(ngModel)]="newUser.email"
        class="w-full border px-4 py-2 rounded"
      />
      <input
        type="password"
        placeholder="Password"
        [(ngModel)]="newUser.password"
        class="w-full border px-4 py-2 rounded"
      />
    </div>
    <div class="mt-6 flex justify-end space-x-2">
      <button (click)="showAddModal = false" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button (click)="addUser()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Add</button>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div
  *ngIf="showEditModal && selectedUser"
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
>
  <div class="bg-white dark:bg-gray-900 rounded-lg w-full max-w-md p-6 relative">
    <button class="absolute top-2 right-2 text-gray-600" (click)="showEditModal = false">✖</button>
    <h3 class="text-xl font-semibold mb-4">Edit User</h3>
    <div class="space-y-4">
      <input
        type="text"
        placeholder="Username"
        [(ngModel)]="selectedUser.username"
        class="w-full border px-4 py-2 rounded"
      />
      <input
        type="email"
        placeholder="Email"
        [(ngModel)]="selectedUser.email"
        class="w-full border px-4 py-2 rounded"
      />
      <input
        type="password"
        placeholder="Password"
        [(ngModel)]="selectedUser.password"
        class="w-full border px-4 py-2 rounded"
      />
    </div>
    <div class="mt-6 flex justify-end space-x-2">
      <button (click)="showEditModal = false" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button (click)="updateUser()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Save</button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div
  *ngIf="showDeleteModal && selectedUser"
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
>
  <div class="bg-white dark:bg-gray-900 rounded-lg w-full max-w-sm p-6 text-center">
    <h3 class="text-lg font-semibold mb-4">Are you sure?</h3>
    <p class="mb-6">You are about to delete user <strong>{{ selectedUser.username }}</strong>.</p>
    <div class="flex justify-center space-x-4">
      <button class="px-4 py-2 bg-gray-300 rounded" (click)="showDeleteModal = false">Cancel</button>
      <button class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" (click)="deleteUser()">Delete</button>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div
  *ngIf="toastMessage"
  class="fixed bottom-6 right-6 px-4 py-3 rounded shadow-lg flex items-center space-x-3 transition-all duration-300"
  [ngClass]="{
    'bg-green-500 text-white': toastSuccess,
    'bg-red-500 text-white': !toastSuccess
  }"
>
  <div class="text-xl">
    {{ toastSuccess ? '✔' : '⚠' }}
  </div>
  <div>{{ toastMessage }}</div>
</div>
